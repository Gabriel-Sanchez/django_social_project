{% extends "base/base.html" %}
{% load static %}

{% block title %}
Eventos
{% endblock title %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/@fullcalendar/core/main.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid/main.min.css" rel="stylesheet">
<style>
    .event-tooltip {
        position: absolute;
        background: white;
        border: 1px solid #ddd;
        padding: 10px;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        z-index: 1000;
        display: none;
    }
    .fc-event {
        cursor: pointer;
    }
    .fc { 
        max-width: 1200px;
        margin: 0 auto;
    }
</style>
{% endblock extra_head %}

{% block content %}
<header class="bg-[rgb(249, 230, 188)] text-black p-4">
    <h1 class="text-center text-3xl font-bold">Eventos</h1>
</header>

<main class="container mx-auto py-8">
    <div class="mb-8">
        <div id="calendar" class="bg-white p-4 rounded-lg shadow-md"></div>
        <div id="eventTooltip" class="event-tooltip"></div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for evento in eventos %}
            <div class="p-4 bg-white rounded-lg shadow-md">
                <h2 class="text-xl font-bold">{{ evento.titulo }}</h2>
                <p class="text-gray-600">{{ evento.fecha|date:"d M Y H:i" }}</p>
                <p class="mt-2">{{ evento.lugar }}</p>
                <p class="mt-2 text-sm text-gray-700">{{ evento.descripcion }}</p>
            </div>
        {% empty %}
            <p class="text-center col-span-full">No hay eventos próximos.</p>
        {% endfor %}
    </div>
</main>
{% endblock %}

{% block scripts_footer %}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.js'></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var tooltip = document.getElementById('eventTooltip');
    
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth'
        },
        locale: 'es',
        events: '/api/calendar-events/',
        eventDidMount: function(info) {
            info.el.addEventListener('mouseover', function() {
                var event = info.event;
                tooltip.style.display = 'block';
                tooltip.innerHTML = `
                    <h3 class="font-bold">${event.title}</h3>
                    <p><strong>Lugar:</strong> ${event.extendedProps.location}</p>
                    <p><strong>Descripción:</strong> ${event.extendedProps.description}</p>
                `;
                
                var rect = info.el.getBoundingClientRect();
                tooltip.style.top = (rect.bottom + window.scrollY + 5) + 'px';
                tooltip.style.left = rect.left + 'px';
            });
            
            info.el.addEventListener('mouseout', function() {
                tooltip.style.display = 'none';
            });
        }
    });
    
    calendar.render();
});
</script>
{% endblock scripts_footer %}